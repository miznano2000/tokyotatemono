# リスク監視ダッシュボード

## 概要
このプロジェクトは、国別リスクとパートナー企業のリスクを監視・分析するためのダッシュボードアプリケーションです。

## 主な機能
- 国別リスク分析（政治、経済、人権）の表示
- パートナー企業リスク分析（経営、財務）の表示
- 財務チャート表示機能（売上・営業利益の棒グラフ）
- リアルタイムアラート管理
- ダークモード対応
- レスポンシブデザイン

## システム要件
- モダンなWebブラウザ（Chrome, Firefox, Safari, Edge最新版）
- JavaScript有効化
- Chart.js（財務グラフ表示のため）

## セットアップ
1. リポジトリをクローン
2. `main.html`をブラウザで開く

## 最近の更新内容（2024年3月）

### 財務リスク分析セクションにグラフ機能を追加（最新）
1. 財務チャート表示機能の実装
   - 売上高推移の棒グラフを追加（2021年〜2025年予測）
   - 営業利益推移の棒グラフを追加（同期間）
   - Chart.jsを使用した interactive な棒グラフ

2. 財務チャート描画関数の追加
   - `renderFinancialChart()`: 棒グラフ専用の描画関数
   - 売上高データ: 12,000〜18,500百万円の範囲
   - 営業利益データ: 1,800〜3,200百万円の範囲
   - ツールチップ機能付き（百万円単位表示）

3. UI/UXデザインの実装
   - 財務チャートコンテナ（`.financial-charts-container`）の追加
   - 2列グリッドレイアウト（デスクトップ）
   - 1列レイアウト（モバイル対応）
   - ダークモード対応のスタイリング

4. 自動描画機能
   - パートナー詳細モーダル表示時に自動的にチャートを描画
   - 既存チャートの破棄・再作成機能
   - 200ms遅延による安定した描画処理

5. レスポンシブ対応
   - タブレット・スマートフォンでの最適な表示
   - グラフサイズの自動調整（デスクトップ: 300px、モバイル: 250px）
   - グリッドレイアウトの自動切り替え

### パートナー企業詳細ページに四半期選択機能を追加
1. 四半期選択ドロップダウンの追加
   - 国の詳細ページと同様の四半期選択機能をパートナー企業詳細ページに実装
   - 2025Q1、2024Q4、2024Q3、2024Q2の選択が可能

2. 四半期別データ表示機能
   - 選択された四半期のデータに基づいて動的にコンテンツを表示
   - 全体リスクレベル、経営陣・ガバナンス分析、財務・業績分析、事業運営分析を追加

3. 専用セクション生成関数の実装
   - `generatePartnerManagementSection`: 経営陣・ガバナンス分析
   - `generatePartnerFinancialSection`: 財務・業績分析  
   - `generatePartnerOperationalSection`: 事業運営分析
   - `updatePartnerModalQuarter`: パートナー企業専用の四半期更新処理

4. UI/UXデザインの統一
   - 国の詳細ページと完全に同じデザインスタイルを適用
   - `quarter-selector-modal`クラスの使用で統一感のある見た目を実現
   - リスクレベル表示を`risk-badge`スタイルに統一

### パートナー企業リスク分析機能の改善
1. データ構造の最適化
   - パートナー企業データを四半期ベースから常時監視形式に変更
   - `quarters`構造から`riskSummary`構造への移行

2. リスク表示の改善
   - 経営リスクと財務リスクを明確に区分
   - 各リスクの詳細な説明を追加
   - リスク概要の表示を140文字以内に最適化

3. UI/UXの改善
   - パートナー企業カードのデザイン刷新
   - リスク情報の視認性向上
   - モーダル表示による詳細情報の閲覧機能追加

4. バグ修正
   - ダッシュボード初期化時のエラー解消
   - パートナー企業詳細表示機能の修正
   - リスク評価ロジックの更新

## 使用技術
- HTML5
- CSS3
- JavaScript (ES6+)
- Chart.js（グラフ表示、財務チャート機能）

## 📊 財務チャート機能の技術詳細

### Chart.js実装
- **描画エンジン**: Chart.js v3.x系を使用
- **グラフタイプ**: 棒グラフ（Bar Chart）
- **データ形式**: JSON形式による構造化データ
- **カラーリング**: 売上高（青系）、営業利益（赤系）の視覚的区分

### 機能仕様
- **データ範囲**: 2021年〜2025年予測（5年間）
- **売上高データ**: 12,000〜18,500百万円
- **営業利益データ**: 1,800〜3,200百万円
- **ツールチップ**: ホバー時に詳細数値表示（百万円単位）
- **レスポンシブ**: 画面サイズに応じた自動リサイズ

### CSS Grid実装
```css
.financial-charts-container {
    display: grid;
    grid-template-columns: 1fr 1fr;  /* デスクトップ: 2列 */
    gap: 2rem;
}

@media (max-width: 768px) {
    .financial-charts-container {
        grid-template-columns: 1fr;   /* モバイル: 1列 */
    }
}
```

### JavaScript関数
- `renderFinancialChart()`: 財務チャート描画専用関数
- `showModal()`: モーダル表示時の自動チャート描画処理
- Chart破棄・再作成による安定した表示制御

## ライセンス
このプロジェクトは社内利用限定です。

## 📊 プロジェクト概要

リスク監視ダッシュボードは、企業のリスク管理チーム向けに開発されたWebアプリケーションです。国別リスク、パートナー企業リスク、経済指標監視、アラート管理を一元的に監視・分析できるプラットフォームを提供します。四半期ごとのデータ管理により、時系列での比較分析が可能で、全画面詳細表示とChart.jsによるインタラクティブなグラフ機能を搭載しています。

## 🌟 主要機能

### 1. エグゼクティブサマリー
- **高リスク注意事項**: 監視対象国・企業のうち高リスク要因のあるものを自動表示
- **監視統計**: 監視対象国数（7カ国）、パートナー企業数（7社）、アクティブアラート数を表示
- **リスク評価基準**: 国別・パートナー企業のリスクレベル（高・中・低）の明確な判定基準を表示
- **最新アラート**: 直近のリスクアラートを優先度別に表示
- **四半期選択**: 過去のデータ（2025Q1、2024Q4など）を選択して時系列比較が可能
- **ダークモード**: システム設定に応じた自動切り替え、手動切り替えも可能

### 2. 国別リスク分析（全画面詳細表示対応）
- **対象国**: 中国、インドネシア、タイ、アメリカ、オーストラリア、シンガポール、インド（7カ国）
- **全画面詳細モーダル**: 各国をクリックで全画面詳細分析画面を表示
- **リスク概要カード**: 政治・経済・人権・総合リスクのビジュアル表示

#### 政治リスク
- **選挙**: 選挙情勢、政治的緊張の詳細分析
- **政府動向・政策**: 経済政策転換、規制変更の影響分析
- **外交**: 二国間関係、多国間協力の動向分析
- **戦争・紛争・デモ**: 軍事的緊張、社会的不安の評価
- **災害**: 自然災害リスク、気候変動対策の分析
- 各項目に詳細コメントと参考資料リンク付き

#### 経済・財政リスク（グラフ表示対応）
- **GDP成長率**: 成長率推移とChart.jsによる時系列グラフ表示
- **対外債務**: 債務総額と対GDP比の推移グラフ
- **経常収支**: 黒字/赤字の推移と貿易構造分析グラフ
- **外貨準備**: 外貨準備高の推移と安定性評価グラフ
- **為替レート**: 通貨変動リスクの時系列グラフ
- **金利**: 金融政策の方向性を示す基準金利推移グラフ
- **税制**: 税制改革と企業への影響分析（テキストレポート）
- **関税政策**: 貿易政策変更の影響評価（テキストレポート）
- 各指標に現在値、単位、詳細分析レポート、参考資料リンク付き

#### 人権リスク
- **人権関連ニュース・国際機関からの指摘**: 国際人権団体レポート、労働環境問題の詳細分析
- サプライチェーン管理への影響評価
- 詳細コメントと参考資料リンク付き

### 3. パートナーリスク分析（全画面詳細表示対応）
- **対象企業**: 7つの不動産パートナー企業
- **全画面詳細モーダル**: 各企業をクリックで全画面詳細分析画面を表示
- **リスク概要カード**: 総合リスク、所在国、格付けのビジュアル表示

#### 経営体制
- **代表者情報**: CEO経歴、経営方針、就任背景の詳細分析
- **主要株主構成**: 株主構成比率、経営安定性、ESG投資方針の評価
- 各項目に詳細コメントと参考資料リンク付き

#### 関連ニュース
- **ニュースリリース・IR資料・決算資料**: 決算説明会、プレスリリース、事業戦略発表の分析
- **メディア報道**: 業界紙評価、アナリストレポート、市場評価の総合分析
- 各ニュース項目に詳細コメントと参考資料リンク付き

#### 財務状況（グラフ表示対応）
- **売上高**: Chart.jsによる時系列グラフと成長率分析
- **営業利益**: 収益性指標の推移グラフと業界比較
- **有利子負債**: 財務健全性指標の推移グラフとD/Eレシオ分析
- **格付け情報**: 信用格付けの詳細分析と財務体質評価
- 各財務指標に現在値、単位、詳細分析レポート、参考資料リンク付き

#### 財務リスク分析セクション（新機能）
- **売上高推移グラフ**: 2021年〜2025年予測の棒グラフ表示
- **営業利益推移グラフ**: 同期間の営業利益推移を視覚化
- **インタラクティブ機能**: Chart.jsによるツールチップ、ホバー効果
- **レスポンシブ表示**: デスクトップは2列、モバイルは1列レイアウト
- **ダークモード対応**: テーマ切り替えに連動したグラフスタイリング
- **自動描画**: パートナー詳細表示時に自動的にチャートを生成・更新

### 4. アラート管理
- **アラートタイプ**: 経済指標悪化、パートナー財務変化、政治的変動、人権問題
- **優先度**: 高・中・低による分類と視覚的表示
- **フィルタリング機能**: 国別・優先度別による絞り込み検索
- **詳細情報**: アラート内容、対象国/企業、発生日時の表示

## 🛠 技術仕様

### フロントエンド
- **HTML5**: セマンティックマークアップ、アクセシビリティ対応
- **CSS3**: カスタムプロパティ（CSS変数）、Flexbox、CSS Grid
- **Vanilla JavaScript (ES6+)**: モジュラー設計、クラスベース構造
- **Chart.js**: 経済指標・財務データの時系列グラフ表示
- **完全レスポンシブデザイン**: モバイル・タブレット・デスクトップ最適化
- **ダークモード完全対応**: システム設定連動、手動切り替え機能

### データ管理
- **JSON形式**: 構造化されたアプリケーション内データストレージ
- **四半期データ構造**: 2023Q1から2025Q1までの時系列データ管理
- **リアルタイム更新**: 現在時刻表示、アラートフィード
- **外部リンク管理**: 根拠資料への直接アクセス機能

### UI/UX
- **全画面モーダル**: 詳細分析用の没入型表示
- **インタラクティブグラフ**: Chart.jsによるホバー効果、ズーム機能
- **アニメーション**: CSS トランジション、フェードイン効果
- **カラーコード**: リスクレベル別の直感的な色分け
- **完全日本語UI**: ビジネス用語を含む専門的な日本語対応

## 🚀 クイックスタート

### 1. ファイルの準備
```bash
# ファイルの確認
ls -la
# main.html, main.css, main.js, README.md
```

### 2. ローカル実行
```bash
# Pythonを使用する場合
python3 -m http.server 8080

# Node.jsを使用する場合
npx http-server -p 8080

# PHPを使用する場合
php -S localhost:8080
```

### 3. ブラウザでアクセス
```
http://localhost:8080/main.html
```

## 📄 ファイル構成

```
tokyotatemono_1/
├── main.html          # メインHTMLファイル
├── main.css           # スタイルシート（ライト/ダークモード対応）
├── main.js            # JavaScriptアプリケーション
└── README.md          # プロジェクト文書
```

## 📊 データ構造

### 国別リスクデータ
```javascript
countries: {
  '中国': {
    quarters: {
      '2025Q1': {
        overallRisk: 'high|medium|low',
        politicalRisk: {
          level: 'medium',
          election: {
            comment: '詳細分析コメント',
            sources: [
              { title: '資料名', url: '#', type: 'report|news|official' }
            ]
          },
          government: { comment: '...', sources: [...] },
          foreign: { comment: '...', sources: [...] },
          conflict: { comment: '...', sources: [...] },
          disaster: { comment: '...', sources: [...] }
        },
        economicRisk: {
          level: 'medium',
          gdpGrowth: {
            comment: '詳細分析コメント',
            value: 5.2,
            unit: '%',
            chartData: [
              { period: '2023Q1', value: 4.5 },
              { period: '2025Q1', value: 5.2 }
            ],
            sources: [...]
          },
          debt: { comment: '...', value: 2.7, unit: '兆ドル', chartData: [...] },
          currentAccount: { comment: '...', value: 485, unit: '億ドル', chartData: [...] },
          reserves: { comment: '...', value: 3.25, unit: '兆ドル', chartData: [...] },
          exchange: { comment: '...', value: 7.25, unit: 'CNY/USD', chartData: [...] },
          interestRate: { comment: '...', value: 3.65, unit: '%', chartData: [...] },
          tax: { comment: '...', sources: [...] },
          tariff: { comment: '...', sources: [...] }
        },
        humanRightsRisk: {
          level: 'high',
          news: {
            comment: '詳細分析コメント',
            sources: [...]
          }
        }
      }
    }
  }
}
```

### パートナーリスクデータ
```javascript
partners: {
  'パートナー企業A': {
    country: '中国',
    quarters: {
      '2025Q1': {
        riskLevel: 'medium',
        management: {
          ceo: {
            comment: '代表者情報の詳細分析',
            sources: [...]
          },
          shareholders: {
            comment: '株主構成の詳細分析',
            sources: [...]
          }
        },
        news: {
          releases: {
            comment: 'IR・決算情報の詳細分析',
            sources: [...]
          },
          media: {
            comment: 'メディア報道の詳細分析',
            sources: [...]
          }
        },
        financialStatus: {
          rating: {
            value: 'BBB+',
            comment: '格付け詳細分析',
            sources: [...]
          },
          revenue: {
            comment: '売上高分析',
            value: 1400,
            unit: '億円',
            chartData: [
              { period: '2023Q1', value: 980 },
              { period: '2025Q1', value: 1400 }
            ],
            sources: [...]
          },
          profit: { comment: '...', value: 119, unit: '億円', chartData: [...] },
          debt: { comment: '...', value: 800, unit: '億円', chartData: [...] }
        }
      }
    }
  }
}
```

## 🎨 リスク評価基準

### 国別リスク評価
- **高リスク**: 政治的不安定、深刻な人権問題、経済構造的問題のいずれかが顕著に存在
- **中リスク**: 一部のリスク要因は存在するが、制度的安定性により管理可能
- **低リスク**: 政治・経済・社会の安定性が高く、法制度や人権保護体制が確立

### パートナー企業リスク評価
- **高リスク**: 財務健全性、ガバナンス、法的コンプライアンスに重大な懸念
- **中リスク**: 一部リスク要因はあるが業界標準範囲内で運営に大きな支障なし
- **低リスク**: 財務体質、経営体制、コンプライアンス体制が良好で安定的

## 🔧 カスタマイズガイド

### データの更新
1. `main.js`の`appData`オブジェクトを編集
2. 四半期データの追加: `quarters`オブジェクトに新しい四半期を追加
3. 新しい国・企業の追加: `countries`や`partners`オブジェクトに新しいエントリを追加
4. グラフデータの更新: `chartData`配列にデータポイントを追加

### スタイルのカスタマイズ
1. `main.css`の`:root`セクションでカラーパレットを変更
2. `--primary-color`、`--risk-high`などのCSS変数を調整
3. ダークモードは`[data-theme="dark"]`セクションで個別設定可能

### 機能の拡張
1. 新しいリスク項目の追加: データ構造とUI表示ロジックを追加
2. 追加のグラフタイプ: Chart.jsの他のグラフタイプを実装
3. エクスポート機能: PDFやExcel出力機能の追加

## 📈 Chart.js グラフ機能

### 対応グラフタイプ
- **線グラフ**: 時系列データの推移表示
- **塗りつぶしエリア**: トレンドの視覚的強調
- **ホバー効果**: データポイントの詳細表示
- **レスポンシブ**: 画面サイズに応じた自動調整

### グラフデータ形式
```javascript
chartData: [
  { period: '2023Q1', value: 4.5 },
  { period: '2023Q2', value: 5.1 },
  { period: '2024Q1', value: 5.3 },
  { period: '2025Q1', value: 5.2 }
]
```

## 🌙 ダークモード

### 自動切り替え
- システムの`prefers-color-scheme`設定に自動対応
- ローカルストレージに設定を保存

### 手動切り替え
- ヘッダーの🌙/☀️ボタンでワンクリック切り替え
- 全てのUIコンポーネントが同期して変更

## 📱 レスポンシブデザイン

### ブレークポイント
- **Desktop**: 1024px以上 - フルレイアウト表示
- **Tablet**: 768px-1023px - サイドバー折りたたみ
- **Mobile**: 767px以下 - モバイル最適化レイアウト

### 最適化要素
- グリッドレイアウトの自動調整
- フォントサイズのスケーリング
- タッチ操作対応のボタンサイズ
- 全画面モーダルのスクロール最適化

## 🐛 トラブルシューティング

### よくある問題

1. **Chart.jsが表示されない**
   - CDNリンクの確認: `https://cdn.jsdelivr.net/npm/chart.js`
   - 詳細モーダルが開いた後にグラフが描画されることを確認

2. **ダークモードが機能しない**
   - ローカルストレージの確認
   - CSS変数の設定確認

3. **モーダルが正しく表示されない**
   - `z-index`の設定確認
   - `overflow: hidden`の適用確認

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 📞 サポート

質問や改善提案がある場合は、プロジェクトのIssuesページでお知らせください。

---

**最終更新**: 2025年1月13日  
**バージョン**: 4.0.0（全画面詳細表示・Chart.js対応版）  
**実装状況**: 本格運用対応完了 